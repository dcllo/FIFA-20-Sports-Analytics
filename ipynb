# -*- coding: utf-8 -*-
"""Untitled5.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14WL1iJB8ezsAMV9EBIxkjM6AB0cP5NXO

Integrantes:

Derek Cuello 23-0774

Diego Puesan 23-0678

# FIFA 20 Sports Analytics

## Descripción

Este proyecto analiza la influencia de la edad en la media de los jugadores en FIFA 20. Utiliza un modelo de regresión lineal para identificar correlaciones y hacer predicciones basadas en la edad.

## Estructura del Proyecto

- `exploration.ipynb`: Exploración inicial de datos y visualización.
- `main.py`: Script principal que ejecuta el análisis completo.
- `etl.py`: Módulo para la carga y procesamiento de datos.
- `ml.py`: Módulo para el modelado y evaluación.
- `data/`: Carpeta que contiene los datos originales y procesados.

## Objetivos del Proyecto:
Analizar la relación entre la edad de los jugadores y su media en FIFA.
Identificar si la edad tiene un impacto significativo en la media.
Desarrollar visualizaciones para entender mejor la distribución de edades y medias.
Implementar un modelo de regresión para predecir la media en función de la edad.

## **Diagrama de flujos**
    
    A[Exploración de Datos] --> B[Proceso ETL]
    B --> C[Análisis Exploratorio y Visualización]
    C --> D[Entrenamiento del Modelo de Regresión Lineal]
    D --> E[Evaluación del Modelo]
    E --> F[Documentación]
    F --> G[Control de Versiones en GitHub]

## Implementación Técnica:

1. Descomprimir y cargar Datos:
"""

!ls /kaggle/input/fifa-20-complete-player-dataset



"""

### 1. **Descripción del Conjunto de Datos**
   - **Tamaño del Dataset**: El dataset tiene 15,465 filas (jugadores) y 104 columnas, que incluyen diversas características de los jugadores, como edad, altura, peso, nacionalidad, club, valoraciones de habilidades, entre otros.
   - **Rango de Edades**: La edad de los jugadores varía de 16 a 44 años.
   - **Valoración General (Overall)**: La valoración general de los jugadores va de 40 a 93.

### 2. **Correlación entre Edad y Media (Overall)**
   - **Correlación**: La correlación entre la edad y la valoración general de los jugadores es de aproximadamente `0.2016`.
     - **Interpretación**: Este valor de correlación es positivo pero bajo, lo que sugiere una relación débil entre la edad y la media de los jugadores. Es decir, a medida que los jugadores envejecen, puede haber una tendencia ligera a tener una mejor valoración, pero no es una relación fuerte.

### 3. **Exploración de los Datos**
   - **Desviación Estándar**: Los valores estándar muestran variabilidad en las características, como la altura, peso, y las habilidades específicas de los jugadores.
   - **Distribución de Valores**: Las medidas como `overall`, `potential`, y otras habilidades muestran que la mayoría de los jugadores están en un rango medio, con pocos jugadores alcanzando valores extremos.

### 4. **Implicaciones del Análisis**
   - **Edad vs. Valoración General**: Aunque hay una correlación positiva entre la edad y la media, el valor bajo de la correlación indica que la edad por sí sola no es un factor determinante para predecir la valoración general de un jugador. Otros factores, como el potencial, la experiencia, y las habilidades específicas del jugador, podrían tener una mayor influencia.
   - **Modelo de Regresión**: Dado que la correlación es baja, el modelo de regresión basado únicamente en la edad probablemente no sea muy preciso para predecir la valoración general de los jugadores. Otros factores deberían considerarse para mejorar el modelo.

### 5. **Visualización**
   - **Gráfico de Dispersión**: Al visualizar la relación entre la edad y la media, probablemente verás un gráfico con puntos dispersos y sin un patrón claro, lo que refuerza la idea de que la relación entre estas variables es débil.

### **Conclusión**

El análisis sugiere que, si bien la edad tiene alguna influencia en la media de los jugadores, esta influencia es bastante limitada. Para un análisis más completo, sería necesario considerar otras variables y posiblemente construir un modelo más complejo que incluya múltiples factores para predecir con precisión la valoración general de un jugador en FIFA."""

# Importar las bibliotecas necesarias
import pandas as pd
import zipfile
import io
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error, r2_score

# Subir el archivo desde el sistema local
from google.colab import files
uploaded = files.upload()

# Obtener el nombre del archivo subido dinámicamente
file_name = list(uploaded.keys())[0]  # Obtener el nombre del archivo subido dinámicamente

# Descomprimir el archivo ZIP
with zipfile.ZipFile(io.BytesIO(uploaded[file_name]), 'r') as zip_ref:
    zip_ref.extractall('/content/')

# Asumiendo que el CSV dentro del ZIP se llama 'players_15.csv'
csv_file = '/content/players_15.csv'

# Cargar el archivo CSV descomprimido
df = pd.read_csv(csv_file)

# Ver las primeras filas del DataFrame
print(df.head())

# Descripción estadística inicial de los datos
print(df.describe())

# Exploración de columnas para identificar posibles columnas relevantes
print(df.columns)

# Proceso ETL: Limpiar los datos y seleccionar las columnas relevantes
def load_and_process_data(filepath):
    # Cargar los datos
    data = pd.read_csv(filepath)

    # Seleccionar columnas relevantes
    data = data[['age', 'overall']]

    # Limpiar datos nulos y duplicados
    data = data.dropna()
    data = data.drop_duplicates()

    return data

# Llamada al proceso ETL
data = load_and_process_data(csv_file)

# Calcular la correlación entre la edad y la media (overall_rating)
if 'age' in data.columns and 'overall' in data.columns:
    corr = data['age'].corr(data['overall'])
    print(f"Correlación entre edad y media: {corr}")

    # Visualización inicial de la relación entre edad y media
    sns.scatterplot(x='age', y='overall', data=data)
    plt.title('Relación entre Edad y Media')
    plt.show()
else:
    print("Las columnas 'age' y/o 'overall' no se encontraron en el conjunto de datos.")

# Proceso de ML: Entrenamiento y Evaluación del Modelo
def split_features_target(data):
    X = data[['age']]
    y = data['overall']
    return X, y

def train_model(X, y):
    # Dividir los datos en entrenamiento y prueba
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    # Crear y entrenar el modelo de regresión lineal
    model = LinearRegression()
    model.fit(X_train, y_train)

    return model, X_test, y_test

def evaluate_model(model, X_test, y_test):
    y_pred = model.predict(X_test)
     # Evaluar el modelo
    mse = mean_squared_error(y_test, y_pred)
    r2 = r2_score(y_test, y_pred)

    print(f'Mean Squared Error: {mse}')
    print(f'R^2 Score: {r2}')

# Entrenar y evaluar el modelo
X, y = split_features_target(data)
model, X_test, y_test = train_model(X, y)
evaluate_model(model, X_test, y_test)
